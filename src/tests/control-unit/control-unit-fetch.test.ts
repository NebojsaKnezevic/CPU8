

import { describe, it, expect } from "vitest";
import { byteToNumber } from "../../constants/byte-conversion";
import { Computer } from "../../CPU8/computer";
import type { Byte } from "../../interface/interfaces";

describe("Control Unit-fetch", () => {
    const computer = new Computer();

    const program = [
        [1, 0, 1, 1, 0, 0, 1, 0],
        [0, 1, 1, 0, 1, 0, 0, 1],
        [1, 1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 0, 0, 1],
        [1, 0, 0, 0, 1, 1, 0, 1],
        [0, 1, 0, 1, 1, 1, 1, 0],
        [1, 1, 1, 0, 0, 0, 1, 1],
        [0, 0, 0, 1, 1, 1, 0, 0],
        [1, 0, 1, 0, 1, 1, 0, 0],
        [0, 1, 0, 0, 0, 1, 0, 1],
        [1, 0, 1, 1, 0, 0, 1, 0],
        [0, 1, 1, 0, 1, 0, 0, 1],
        [1, 1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 0, 0, 1],
        [1, 0, 0, 0, 1, 1, 0, 1],
        [0, 1, 0, 1, 1, 1, 1, 0],
        [1, 1, 1, 0, 0, 0, 1, 1],
        [0, 0, 0, 1, 1, 1, 0, 0],
        [1, 0, 1, 0, 1, 1, 0, 0],
        [1, 0, 1, 1, 0, 0, 1, 0],
        [0, 1, 1, 0, 1, 0, 0, 1],
        [1, 1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 0, 0, 1],
        [1, 0, 0, 0, 1, 1, 0, 1],
        [0, 1, 0, 1, 1, 1, 1, 0],
        [1, 1, 1, 0, 0, 0, 1, 1],
        [0, 0, 0, 1, 1, 1, 0, 0],
        [1, 0, 1, 0, 1, 1, 0, 0],
        [1, 0, 1, 1, 0, 0, 1, 0],
        [0, 1, 1, 0, 1, 0, 0, 1],
        [1, 1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 0, 0, 1],
        [1, 0, 0, 0, 1, 1, 0, 1],
        [0, 1, 0, 1, 1, 1, 1, 0],
        [1, 1, 1, 0, 0, 0, 1, 1],
        [0, 0, 0, 1, 1, 1, 0, 0],
        [1, 0, 1, 0, 1, 1, 0, 0],
        [1, 0, 1, 1, 0, 0, 1, 0],
        [0, 1, 1, 0, 1, 0, 0, 1],
        [1, 1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 0, 0, 1],
        [1, 0, 0, 0, 1, 1, 0, 1],
        [0, 1, 0, 1, 1, 1, 1, 0],
        [1, 1, 1, 0, 0, 0, 1, 1],
        [0, 0, 0, 1, 1, 1, 0, 0],
        [1, 0, 1, 0, 1, 1, 0, 0]
        
    ]

    computer.insertProgramIntoRAM(0, program as Byte[]);



    it("should fetch proper data from RAM into IR", () => {

        for (let i = 0; i < program.length; i++) {
            computer.run(1);
            expect(byteToNumber(computer.iar.getData())).toEqual(i + 1);
            expect(program[i]).toEqual(computer.ir.getData());
        }


    })


});